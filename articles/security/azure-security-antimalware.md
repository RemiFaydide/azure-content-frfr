<properties
   pageTitle="Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles | Microsoft Azure"
   description="Cet article fournit une présentation de l’architecture de Microsoft Antimalware pour Azure, y compris des scénarios et configurations pris en charge pour l’activation, la configuration et le déploiement de la protection pour Azure Cloud Services et les machines virtuelles. Nous y étudierons la configuration de base, la gestion et la surveillance des fonctionnalités accessibles via les API de gestion des services Microsoft Azure, les scripts PowerShell, le portail Azure et Visual Studio."
   services="security"
   documentationCenter="na"
   authors="YuriDio"
   manager="swadhwa"
   editor=""/>

<tags
   ms.service="security"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/19/2016"
   ms.author="yurid"/>

#Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles

Le paysage des menaces modernes pour les environnements de cloud est extrêmement dynamique, augmentant la pression sur les abonnés aux services informatiques dans le cloud en faveur du maintien d’une protection efficace répondant aux exigences de conformité et de sécurité. Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles est une fonctionnalité de protection en temps réel gratuite qui permet d’identifier et de supprimer les virus, les logiciels espions et autres logiciels malveillants grâce à des alertes configurables vous avertissant lorsque des logiciels malveillants ou indésirables connus tentent de s’installer ou de s’exécuter sur vos systèmes Azure.

La solution s’appuie sur la même plateforme anti-programmes malveillants que Microsoft Security Essentials [MSE] Microsoft Forefront Endpoint Protection, Microsoft System Center Endpoint Protection, Windows Intune et Windows Defender pour Windows 8.0 et versions ultérieures. Microsoft Antimalware pour Azure est une solution d’agent unique pour les applications et les environnements client, conçue pour s’exécuter en arrière-plan sans intervention humaine. Vous pouvez déployer la protection en fonction des besoins de vos charges de travail d’application, avec une configuration de base sécurisée par défaut ou une configuration personnalisée avancée, y compris pour la surveillance anti-programmes malveillants.

Lorsque vous déployez et activez Microsoft Antimalware pour Azure pour vos applications, les fonctionnalités essentielles suivantes sont disponibles :

- **Protection en temps réel** : surveille l’activité dans Cloud Services et sur les machines virtuelles pour détecter et bloquer l’exécution de logiciels malveillants.
- **Analyse planifiée** : effectue périodiquement une analyse ciblée pour détecter les logiciels malveillants, y compris les programmes en cours d’exécution.
- **Correction de logiciels malveillants** : prend automatiquement des mesures sur les programmes malveillants détectés, notamment la suppression ou la mise en quarantaine des fichiers malveillants et le nettoyage des entrées de registre malveillantes.
- **Mises à jour de signatures** : installe automatiquement les dernières signatures de protection (définitions de virus) pour garantir la mise à jour de la protection selon une fréquence prédéfinie.
- **Mises à jour du moteur Antimalware** : met automatiquement à jour le moteur Microsoft Antimalware.
- **Mises à jour de la plateforme Antimalware** : met automatiquement à jour la plateforme Microsoft Antimalware.
- **Protection active** : signale les métadonnées de télémétrie relatives aux menaces détectées et aux ressources suspectes à Microsoft Azure afin d’assurer une réaction rapide au paysage de menaces en constante évolution, et d’activer la remise de signatures synchrones en temps réel via le système MAPS (système de protection active Microsoft).
- **Exemples de création de rapport** : crée et fournit des exemples de rapports au service Microsoft Antimalware pour contribuer à améliorer le service et permettre la résolution des problèmes.
- **Exclusions** : permet aux administrateurs d’applications et de services de configurer certains fichiers, processus et lecteurs pour les exclure de la protection et de l’analyse, entre autres pour des raisons de performances.
- **Collecte d’événements Antimalware** : enregistre l’intégrité du service Antimalware, les activités suspectes et les mesures de correction prises dans le journal des événements du système d’exploitation et les rassemble dans le compte de stockage Azure du client.

> [AZURE.NOTE] Microsoft Antimalware peut également être déployé à l’aide de Azure Security Center. Consultez [Installer Endpoint Protection dans Azure Security Center](../security-center/security-center-install-endpoint-protection.md) pour plus d’informations.

##Architecture

La solution Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles inclut Microsoft Antimalware clients et services, le modèle de déploiement classique Antimalware, les applets de commande Antimalware PowerShell et l’extension de diagnostics Azure. La solution Microsoft Antimalware est prise en charge sur Windows Server 2008 R2, Windows Server 2012 et les familles de systèmes d’exploitation Windows Server 2012 R2. Elle n’est pas prise en charge sur le système d’exploitation Windows Server 2008. À ce stade, Windows Server Technical Preview n’est pas pris en charge, mais nous avons l’intention d’assurer une prise en charge à l’avenir.

Microsoft Antimalware clients et services est installé par défaut à l’état désactivé dans toutes les familles de systèmes d’exploitation invités Azure prises en charge dans la plateforme Cloud Services. Microsoft Antimalware clients et services n’est pas installé par défaut dans la plateforme de machines virtuelles et est disponible en tant que fonctionnalité facultative via le portail Azure et la configuration de machines virtuelles Visual Studio sous Extensions de sécurité.

Si vous utilisez des sites web Azure, le serveur sous-jacent qui héberge l’application web dispose d’une version activée de Microsoft Antimalware. Elle permet de protéger l’infrastructure de sites Web Azure et ne s’exécute pas sur le contenu du client.


###Workflow Microsoft Antimalware

L’administrateur de services Azure peut activer Antimalware pour Azure avec une configuration par défaut ou personnalisée pour vos machines virtuelles et Cloud Services à l’aide des options suivantes :

-   Machines virtuelles : dans le portail Azure, sous **Extensions de sécurité**

-   Machines virtuelles : à l’aide de la configuration de machines virtuelles Visual Studio dans l’Explorateur de serveurs

-   Machines virtuelles et Cloud Services : à l’aide du [modèle de déploiement classique](https://msdn.microsoft.com/library/azure/ee460799.aspx) Antimalware

-   Machines virtuelles et Cloud Services : à l’aide des applets de commande Antimalware PowerShell

Le portail Azure ou les applets de commande PowerShell transmettent le fichier de package de l’extension Antimalware au système Azure vers un emplacement fixe prédéfini. L’agent invité Azure (ou l’agent de structure) lance l’extension Antimalware, en appliquant les paramètres de configuration Antimalware fournis en tant qu’entrée. Cette étape active le service Antimalware avec les paramètres de configuration par défaut ou personnalisés. Si aucune configuration personnalisée n’est fournie, le service Antimalware est activé avec les paramètres de configuration par défaut. Consultez la section *Configuration Antimalware* dans [Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles : exemples de code](http://aka.ms/amazsamples "Exemples de code Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles") pour plus de détails.

Une fois exécuté, le client Microsoft Antimalware télécharge les dernières définitions de moteur de protection et de signature à partir d’Internet et les charge sur le système Azure. Le service Microsoft Antimalware écrit les événements relatifs au service dans le journal des événements système du système d’exploitation sous la source d’événements « Microsoft Antimalware ». Les événements incluent l’état d’intégrité du client Antimalware, l’état de protection et de correction, les paramètres de configuration nouveaux et anciens, les mises à jour du moteur et les définitions de signature, entre autres.

Vous pouvez activer la surveillance Antimalware pour Cloud Services ou vos machines virtuelles, de sorte que les événements du journal des événements Antimalware soient écrits alors qu’ils sont produits sur votre compte de stockage Azure. Le service Antimalware utilise l’extension des diagnostics Azure pour collecter les événements Antimalware à partir du système Azure dans des tables dans le compte de stockage Azure du client.

Le flux de travail de déploiement, incluant les étapes et les options de configuration prises en charge pour les scénarios ci-dessus, est documenté dans la section [Scénarios de déploiement Antimalware](#_Antimalware_Deployment_Scenarios) de ce document.

![Microsoft Antimalware dans Azure](./media/azure-security-antimalware/sec-azantimal-fig1.PNG)

> [AZURE.NOTE] Vous pouvez toutefois utiliser Powershell ou des API et des modèles Azure Resource Manager pour déployer des jeux de mise à l’échelle de machine virtuelle avec l’extension Microsoft Anti-Malware. Pour installer une extension sur une machine virtuelle en cours d’exécution, vous pouvez utiliser l’exemple de script python *vmssextn.py* qui se trouve [ici](https://github.com/gbowerman/vmsstools). Ce script obtient la configuration de l’extension existant sur le jeu de mise à l’échelle et ajoute une extension à la liste des extensions existantes sur le jeu de mise à l’échelle de machine virtuelle.

###Configuration Antimalware par défaut et personnalisée

Les paramètres de configuration par défaut sont appliqués pour activer Antimalware pour Azure Cloud Services ou les machines virtuelles lorsque vous ne fournissez pas de paramètres de configuration personnalisés. Les paramètres de configuration par défaut ont été préalablement optimisés pour l’exécution dans l’environnement Azure. Éventuellement, vous pouvez personnaliser ces paramètres de configuration par défaut en fonction des besoins de votre déploiement d’applications ou de services Azure, et les appliquer à d’autres scénarios de déploiement.

> [AZURE.NOTE] Par défaut, l’interface utilisateur de Microsoft Antimalware sur Azure Resource Manager est désactivée, et le fichier [cleanuppolicy.xml](https://blogs.msdn.microsoft.com/azuresecurity/2016/02/24/update-on-microsoft-antimalware-and-azure-resource-manager-arm-vms/) permettant d’ignorer ce message d’erreur n’est pas pris en charge. Pour plus d’informations sur la création d’une stratégie personnalisée, consultez [Activation de l’interface utilisateur Microsoft Antimalware sur des machines virtuelles Azure Resource Manager après le déploiement](https://blogs.msdn.microsoft.com/azuresecurity/2016/03/09/enabling-microsoft-antimalware-user-interface-post-deployment/).

Le tableau suivant résume les paramètres de configuration disponibles pour le service Antimalware. Les paramètres de configuration par défaut sont marqués dans la colonne intitulée « Par défaut » ci-dessous.

![Tableau 1](./media/azure-security-antimalware/sec-azantimal-tb18.PNG)

##Scénarios de déploiement Antimalware

Les scénarios permettant d’activer et de configurer Antimalware, y compris la surveillance pour Azure Cloud Services et les machines virtuelles, sont présentés dans cette section.

###Machines virtuelles : activer et configurer Antimalware

**Déploiement à l’aide du portail Azure**

Pour activer le service Antimalware, cliquez sur **Ajouter** dans le panneau Extensions, sélectionnez **Microsoft Antimalware** dans le panneau Nouvelle ressource, puis cliquez sur **Créer** dans le panneau Microsoft Antimalware. Cliquez sur **Créer** sans entrer de valeurs de configuration pour activer Antimalware avec les paramètres par défaut, ou entrez les paramètres de configuration Antimalware de la machine virtuelle configurée, comme indiqué dans la Figure 2 ci-dessous. Consultez l’**info-bulle** fournie avec chaque paramètre de configuration sur le panneau Ajouter une extension pour afficher les valeurs de configuration prises en charge.

![Paramètres de configuration des machines virtuelles pour Microsoft Antimalware](./media/azure-security-antimalware/sec-azantimal-fig2.PNG)

**Déploiement à l’aide du portail Azure Classic**

Pour activer et configurer Microsoft Antimalware pour les machines virtuelles Azure à l’aide du portail Azure lors de l’approvisionnement d’une machine virtuelle, procédez comme suit :

1\. Connectez-vous portail Azure à l’adresse <https://portal.azure.com>

2\.Pour créer une machine virtuelle, cliquez sur **Nouveau**, **Calcul**, **Machine** **virtuelle**, **À partir de la galerie** (n’utilisez pas Création rapide) comme illustré ci-dessous :

![Nouvelle machine virtuelle](./media/azure-security-antimalware/sec-azantimal-fig3.PNG)


3\.Sélectionnez l’image **Microsoft Windows Server** sur la page **Choisir une image**.

4\.Cliquez sur la flèche droite et entrez la configuration de la machine virtuelle.

5\. Cochez la case **Microsoft Antimalware** sous **Extensions de sécurité** sur la page de configuration de la machine virtuelle.

6\.Cliquez sur le bouton Envoyer pour activer et configurer Microsoft Antimalware pour les machines virtuelles Azure avec les paramètres de configuration par défaut.

![Configuration des machines virtuelles](./media/azure-security-antimalware/sec-azantimal-fig4.PNG)

**Déploiement à l’aide de la configuration des machines virtuelles de Visual Studio**

Pour activer et configurer le service Microsoft Antimalware à l’aide de Visual Studio :

1\.Connectez-vous à Microsoft Azure dans Visual Studio.

2\.Choisissez votre machine virtuelle sous le nœud **Machines virtuelles** dans l’**Explorateur de serveurs**.

![Configuration des machines virtuelles dans Visual Studio](./media/azure-security-antimalware/sec-azantimal-fig5.PNG)

3\.Cliquez avec le bouton droit sur **Configurer** pour afficher la page de configuration des machines virtuelles.

4\.Sélectionnez l’extension **Microsoft Antimalware** dans la liste déroulante sous **Extensions installées**, puis cliquez sur **Ajouter** pour configurer avec la configuration Antimalware par défaut.

![Extensions installées](./media/azure-security-antimalware/sec-azantimal-fig6.PNG)

5\.Pour personnaliser la configuration Antimalware par défaut, sélectionnez (mettez en surbrillance) l’extension Antimalware dans la liste des extensions installées, puis cliquez sur **Configurer**.

6\.Remplacez la configuration Antimalware par défaut par votre configuration personnalisée au format JSON pris en charge dans la zone de texte **Configuration publique**, puis cliquez sur OK.

7\.Cliquez sur le bouton **Mettre à jour** pour envoyer les mises à jour de la configuration à votre machine virtuelle.

![Extension de la configuration des machines virtuelles](./media/azure-security-antimalware/sec-azantimal-fig7.PNG)

**Remarque :** la configuration des machines virtuelles de Visual Studio pour Antimalware prend uniquement en charge la configuration au format JSON. Le modèle de paramètres de configuration JSON Antimalware est inclus dans [Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles : exemples de code](http://aka.ms/amazsamples "Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles : exemples de code") et indique les paramètres de configuration Antimalware pris en charge.

**Déploiement à l’aide d’applets de commande PowerShell**

Une application ou un service Azure peut activer et configurer Microsoft Antimalware pour les machines virtuelles Azure à l’aide des applets de commande PowerShell.

Pour activer et configurer Microsoft Antimalware à l’aide des applets de commande Antimalware PowerShell :

1. Configurez votre environnement PowerShell ; reportez-vous à la documentation à l’adresse <https://github.com/Azure/azure-powershell>.

2. Utilisez l’applet de commande Antimalware Set-AzureVMMicrosoftAntimalwareExtension pour activer et configurer Microsoft Antimalware pour votre machine virtuelle, comme décrit à l’adresse <http://msdn.microsoft.com/library/azure/dn771718.aspx>.

**Remarque :** la configuration des machines virtuelles Azure pour Antimalware prend uniquement en charge la configuration au format JSON. Le modèle de paramètres de configuration JSON Antimalware est inclus dans [Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles : exemples de code](http://aka.ms/amazsamples "Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles : exemples de code") et indique les paramètres de configuration Antimalware pris en charge.

###Activer et configurer Antimalware à l’aide des applets de commande PowerShell

Une application ou un service Azure peut activer et configurer Microsoft Antimalware pour Azure Cloud Services à l’aide des applets de commande PowerShell. Notez que Microsoft Antimalware est installé à l’état désactivé dans la plateforme Cloud Services et nécessite une action d’une application Azure pour être activé.

Pour activer et configurer Microsoft Antimalware à l’aide des applets de commande PowerShell :

1.  Configurez votre environnement PowerShell ; reportez-vous à la documentation à l’adresse <https://github.com/Azure/azure-sdk-tools#get-started>.

2.  Utilisez l’applet de commande Antimalware Set-AzureServiceAntimalwareExtension pour activer et configurer Microsoft Antimalware pour votre service cloud, comme décrit à l’adresse <http://msdn.microsoft.com/library/azure/dn771718.aspx>.

Le modèle de paramètres de configuration XML Antimalware est inclus dans [Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles : exemples de code](http://aka.ms/amazsamples "Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles : exemples de code") et indique les paramètres de configuration Antimalware pris en charge.

###Cloud Services et les machines virtuelles : configuration à l’aide des applets de commande PowerShell

Une application ou un service Azure peut récupérer la configuration de Microsoft Antimalware pour Cloud Services et les machines virtuelles à l’aide des applets de commande PowerShell.

Pour récupérer la configuration de Microsoft Antimalware à l’aide des applets de commande PowerShell :

1.  Configurez votre environnement PowerShell ; reportez-vous à la documentation à l’adresse <https://github.com/Azure/azure-sdk-tools#get-started>.

2.  **Pour les machines virtuelles** : utilisez l’applet de commande Antimalware Get-AzureVMMicrosoftAntimalwareExtension pour obtenir la configuration Antimalware, comme décrit à l’adresse <http://msdn.microsoft.com/library/azure/dn771719.aspx>.

3.  **Pour Cloud Services** : utilisez l’applet de commande Antimalware Get-AzureServiceAntimalwareConfig pour obtenir la configuration Antimalware, comme décrit à l’adresse <http://msdn.microsoft.com/library/azure/dn771722.aspx>.

###Supprimer la configuration Antimalware à l’aide des applets de commande PowerShell

Une application ou un service Azure peut supprimer la configuration Antimalware et toute configuration de surveillance Antimalware des extensions Azure Antimalware et de service de diagnostics pertinentes associées à Cloud Services ou aux machines virtuelles.

Pour supprimer Microsoft Antimalware à l’aide des applets de commande PowerShell :

1.  Configurez votre environnement PowerShell ; reportez-vous à la documentation à l’adresse <https://github.com/Azure/azure-sdk-tools#get-started>.

2.  **Pour les machines virtuelles** : utilisez l’applet de commande Antimalware Remove-AzureVMMicrosoftAntimalwareExtension, comme décrit à l’adresse <http://msdn.microsoft.com/library/azure/dn771720.aspx>.

3.  **Pour Cloud Services** : utilisez l’applet de commande Antimalware Remove-AzureServiceAntimalwareExtension, comme décrit à l’adresse <http://msdn.microsoft.com/library/azure/dn771717.aspx>.

Pour **activer** la collecte d’événements Antimalware pour une machine virtuelle à l’aide du portail Azure en version préliminaire :

1.  Cliquez n’importe où dans le Filtre Monitoring du panneau Machine virtuelle.

2.  Cliquez sur la commande Diagnostics dans le panneau Mesures.

3.  Activez l’**État** et l’option des événements système Windows
4.  . Vous pouvez choisir de désactiver toutes les autres options de la liste ou les laisser activées en fonction des besoins de votre service d’application.

4.  Les catégories d’événements Antimalware (« Erreur », « Avertissement », « Information », etc.) sont capturées dans votre compte de stockage Azure.

Les événements Antimalware sont collectés à partir des journaux des événements système Windows vers votre compte de stockage Azure. Vous pouvez configurer le compte de stockage pour que votre machine virtuelle collecte les événements Antimalware en sélectionnant le compte de stockage approprié.

![Mesures et diagnostics](./media/azure-security-antimalware/sec-azantimal-fig8.PNG)

> [AZURE.NOTE] Pour plus d’informations sur la journalisation des diagnostics pour Azure Antimalware, consultez [Activation de la journalisation des diagnostics pour Azure Antimalware](https://blogs.msdn.microsoft.com/azuresecurity/2016/04/19/enabling-diagnostics-logging-for-azure-antimalware/).

###Activer et configurer la surveillance Antimalware à l’aide des applets de commande PowerShell

Vous pouvez activer la collecte des événements Microsoft Antimalware pour Cloud Services ou vos machines virtuelles à l’aide des diagnostics Azure via les applets de commande Antimalware PowerShell. L’extension de diagnostics Azure peut être configurée pour capturer des événements à partir de la source de journaux des événements système « Microsoft Antimalware » vers votre compte de stockage Azure. Les catégories d’événements Antimalware (« Erreur », « Avertissement », « Information », etc.) sont capturées dans votre compte de stockage Azure.

Pour activer la collecte d’événements Antimalware vers votre compte de stockage Azure à l’aide des applets de commande PowerShell :

1.  Configurez votre environnement PowerShell ; reportez-vous à <https://github.com/Azure/azure-sdk-tools#get-started>.

2.  **Pour les machines virtuelles** : utilisez l’applet de commande Antimalware Set-AzureVMMicrosoftAntimalwareExtension avec l’option de surveillance activée, comme décrit à l’adresse <http://msdn.microsoft.com/library/azure/dn771716.aspx>.

3.  **Pour Cloud Services** : utilisez l’applet de commande Antimalware Set-AzureServiceAntimalwareExtension avec l’option de surveillance activée, comme décrit à l’adresse <http://msdn.microsoft.com/library/azure/dn771718.aspx>.

Vous pouvez afficher les événements bruts Antimalware en examinant la table WADWindowsEventLogsTable dans le compte de stockage Azure que vous avez configuré pour activer la surveillance Antimalware. Cela peut être utile pour vérifier le fonctionnement de la collecte d’événements Antimalware, y compris pour visualiser l’état d’intégrité du service Antimalware. Pour plus d’informations, y compris pour des exemples de code sur la façon d’extraire des événements Antimalware de votre compte de stockage, reportez-vous à [Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles : exemples de code](http://aka.ms/amazsamples "Microsoft Antimalware pour Azure Cloud Services et les machines virtuelles : exemples de code").

<!---HONumber=AcomDC_0921_2016-->